
- **RAG 是“把外部知识取来用”的能力**
- **Agent 是“会自己分解任务与调用工具”的大脑。**


在 PDF 手册问答场景里，RAG 负责把相关页/表/图找出来并提供证据，**Agent 负责在需要时多步推理、选择合适的工具（OCR/表格解析/代码执行/单位换算/版本过滤等），直到给出可验证的答案**。

# 两者如何配合

- **无 Agent 的经典 RAG（流水线）**：检索 → 重排 → 生成答案（附引用）。  
    适合单跳问题：如“型号 A 的额定电压？”（*文本里直接有答案*）。
    
- **Agentic RAG（有策略与工具调用）**：
    
    1. 识别问题类型（参数/步骤/对比/图示解释）；
        
    2. 按需调用工具：`retrieve_text` / `retrieve_table` / `retrieve_figure` / `ocr` / `run_sql_or_pandas` / `unit_convert` / `version_filter` / `highlight_pdf`；
        
    3. 自我检查（有没有证据？单位是否一致？多个版本冲突如何处理？）；
        
    4. 产出“答案 + 可视化证据（页码/坐标高亮）”。  
        适合**跨页表格、图文混排、多步计算/校验**等复杂问题。

# agent给RAG带来的额外能力
- **表格问答**：先用 RAG 找到表，然后 Agent 让模型**生成 Pandas/SQL**并执行，做筛选/聚合/单位换算，再把结果回填（可校验、可复现）。
    
- **图片/示意图理解**：RAG 召回相应图片块与邻近文字；Agent 调用多模态模型做描述/定位，返回高亮框。
    
- **版本与适用机型过滤**：Agent 根据用户上下文（如“V2.1 固件、三相 380V 机型”）自动加检索过滤与冲突提示。
    
- **多步推理与工具编排**：如“把 A 与 B 型号在 40℃ 下的额定电流对比并给结论”，Agent 会分：找表→筛选→温度修正→对比→给结论与证据。
    
- **失败回退与自我纠错**：表格解析失败→改用 OCR/PP-Structure；检索不到证据→给相近章节并说明“不确定”。

# 什么时候用 Agent、什么时候不用

- **不用/少用 Agent**：问答以“定位+摘录”为主，单步即可，追求极低延迟与稳定成本。
    
- **应该用 Agent**：
    
    - 涉及**表格计算、单位换算、条件过滤、跨文档对比**；
        
    - **多模态**（图示/电气原理图）必须参与；
        
    - 需要**明确可验证的步骤与证据**（合规/审计友好）。


# 最小可行落地（建议）

- **Level 0：确定性 RAG 流水线**（无 Agent）  
    分块+检索+重排+答案（含引用+页码）。
    
- **Level 1：轻量 Agent 路由**（有限工具、有限步数）  
    只引入 3–5 个关键工具：`retrieve_*`、`run_sql_or_pandas`、`unit_convert`、`highlight_pdf`。设置**最大 3~5 步**、**白名单工具**、**超时**、**必须引用证据**这些**护栏**。
    
- **Level 2：多模态 Agent**  
    加入图片块检索与多模态模型，支持图示定位与说明。

# 实施要点与“护栏”

- **可观测性**：记录每一步的工具输入/输出与来源页；
    
- **确定性与成本**：限制步数、工具白名单、缓存检索结果；
    
- **可靠性**：必须附**页码+坐标**；表格答案必须**经代码执行得到**；检索缺失时要明确“不确定”；
    
- **评测**：用合成集+真题集分别评**命中率、准确率、可解释性**（有/无 Agent 对比）。




